---
# Modules Used

# https://docs.ansible.com/ansible/latest/modules/cloudformation_module.html
# https://docs.ansible.com/ansible/latest/modules/cloudformation_info_module.html
# https://docs.ansible.com/ansible/latest/user_guide/playbooks_delegation.html 

# Ansible Information
- name: Set Ansible Information
  hosts: localhost
  gather_facts: False
  connection: local
  vars:
    stack_name: ""
    #More variables below

# Launch AWS bigip cloudformation stack
  tasks:
    - name: Deploy AWS BIGIP Cluster
      cloudformation:
        stack_name: "{{ stack_name }}"
        state: present
        region: us-west-2
        disable_rollback: false
        template: "~/f5-rs-aws/templates/f5-existing-stack-same-az-cluster-payg-3nic-bigip.template"
        template_parameters:
          sshKey: ""
          restrictedSrcAddress: ""
          restrictedSrcAddressApp: ""
          Vpc: ""
          managementSubnetAz1: ""
          managementSubnetAz2: ""
          subnet1Az1: ""
          subnet1Az2: ""
          subnet2Az1: ""
          subnet2Az2: ""
          availabilityZone1: ""
          availabilityZone2: ""
          numberOfAdditionalNics: ""
          additionalNicLocation: ""
          provisionPublicIP: "yes"
          imageName: "AllTwoBootLocations"
          customImageId: "OPTIONAL"
          instanceType: "m5.xlarge"
          ntpServer: "0.pool.ntp.org"
          timezone: "UTC"
          bigIpModules: "ltm:nominal,asm:nominal"
          application: "f5app"
          environment: "f5env"
          group: "f5group"
          owner: "f5owner"
          costcenter: "f5costcenter"
          allowUsageAnalytics: "Yes"
          declarationUrl: "none"
        tags:
          Stack: ansible-cloudformations

    - name: Get summary information about a stack
      cloudformation_info:
        stack_name: "{{ stack_name }}"
      register: "BigipCloudformationOutput"
      
    - name: Output the stack information to ~/
      local_action: 
        copy content={{ BigipCloudformationOutput }} dest=~/ansible-bigip-cloudformation-output.txt